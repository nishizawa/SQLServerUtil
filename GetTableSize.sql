-- テーブルのサイズを取得する 
-- SQLServer2005以降

DECLARE @SPACES TABLE
(
	 [NAME] SYSNAME
	,[ROWS] BIGINT
	,[RESERVED] VARCHAR(18)
	,[DATA] VARCHAR(18)
	,[INDEX_SIZE] VARCHAR(18)
	,[UNUSED] VARCHAR(18)
)

DECLARE @TABLE_NAME sysname

DECLARE @TABLE_CURSOR CURSOR
SET @TABLE_CURSOR = CURSOR LOCAL FAST_FORWARD
FOR
	SELECT
		 [name]
	FROM [sys].[objects]
	WHERE
		[TYPE] = 'U'

OPEN @TABLE_CURSOR

FETCH NEXT FROM @TABLE_CURSOR
INTO
	 @TABLE_NAME

WHILE (@@FETCH_STATUS = 0)
BEGIN
	INSERT INTO @SPACES
	EXEC sp_spaceused @TABLE_NAME

	FETCH NEXT FROM @TABLE_CURSOR
	INTO
		 @TABLE_NAME
END

CLOSE @TABLE_CURSOR
DEALLOCATE @TABLE_CURSOR

SELECT * 
FROM @SPACES
ORDER BY
 [name]
